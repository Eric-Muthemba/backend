generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  DOCTOR
  ADMIN
  NURSE
  CASHIER
  PHARMACIST
  LABTECH
}

enum PaymentMethods {
  MPESA
  CARD
}

enum PaymentStatus {
  PENDING
  PAID
  CANCELLED
}


model User {
  id            String   @id @default(uuid())
  name          String
  email         String   @unique
  phone_number  String
  password      String
  roles         Role[]   @default([PHARMACIST])
  prescriptions Prescription[]
  patients Patient[]
  drugs Drug[]
  medical_records MedicalRecord[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Patient {
  id              String              @id @default(uuid())
  firstName       String
  lastName        String
  dob             DateTime
  gender          String
  address         String?
  phone           String?
  createdBy       User             @relation(fields: [createdById], references: [id])
  createdById     String
  isDeleted       Boolean          @default(false)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  medicalRecords  MedicalRecord[]
}

model MedicalRecord {
  id         String       @id @default(uuid())
  patient    Patient   @relation(fields: [patientId], references: [id])
  patientId  String
  notes      String
  date       DateTime
  prescriptions Prescription[]
  createdBy       User             @relation(fields: [createdById], references: [id])
  createdById     String
  isDeleted       Boolean          @default(false)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
}

model Prescription {
  id            String            @id @default(uuid())
  medicalRecord MedicalRecord  @relation(fields: [medicalRecordId], references: [id])
  medicalRecordId String
  prescriptionDrugs PrescriptionDrug[]
  PrescriptionPayments      PrescriptionPayments[]
  createdBy       User             @relation(fields: [createdById], references: [id])
  createdById     String
  isDeleted       Boolean          @default(false)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model Drug {
  id         String       @id @default(uuid())
  name       String
  description String?
  quantity   Int
  price   Float
  createdBy       User             @relation(fields: [createdById], references: [id])
  createdById     String
  isDeleted       Boolean          @default(false)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  prescriptionDrugs PrescriptionDrug[]
}


model PrescriptionDrug {
  id            String              @id @default(uuid())
  prescription  Prescription     @relation(fields: [prescriptionId], references: [id])
  prescriptionId String
  drug          Drug             @relation(fields: [drugId], references: [id])
  drugId        String
  quantity      Int
  sellingPrice  Float
  note          String
}

model Payment {
  id            String           @id @default(uuid())
  amount        Float
  method        PaymentMethods   @default(MPESA)
  status        PaymentStatus   @default(PENDING)
  description        String   @default("-")
  reference     String?        @unique
  checkout_id     String      @default("-")
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  PrescriptionPayments      PrescriptionPayments[]
}


model PrescriptionPayments {
    id            String           @id @default(uuid())
    prescription  Prescription     @relation(fields: [prescriptionId], references: [id])
    prescriptionId String
    payment  Payment     @relation(fields: [paymentId], references: [id])
    paymentId String
}